global:
  # Resolve timeout is the time after which an alert is declared resolved if it has not been updated.
  resolve_timeout: 5m
  # The default SMTP From header field.
  smtp_from: '${ALERTMANAGER_SMTP_FROM}'
  # The default SMTP smarthost and port, with authentication information.
  smtp_smarthost: '${ALERTMANAGER_SMTP_SMARTHOST}'
  smtp_auth_username: '${ALERTMANAGER_SMTP_AUTH_USERNAME}'
  smtp_auth_password: '${ALERTMANAGER_SMTP_AUTH_PASSWORD}'
  smtp_require_tls: true

# The root route on which each incoming alert enters.
route:
  # The labels by which incoming alerts are grouped together. 
  group_by: ['alertname', 'severity']
  
  # When a new group of alerts is created by an incoming alert, wait at least 'group_wait' to send the initial notification.
  group_wait: 10s
  
  # When the first notification was sent, wait 'group_interval' to send a batch of new alerts that started firing for that group.
  group_interval: 5m
  
  # If an alert has successfully been sent, wait 'repeat_interval' to resend them.
  repeat_interval: 3h
  
  # A default receiver
  receiver: 'default-receiver'
  
  # All the above attributes are inherited by all child routes and can overwritten on each.
  routes:
  # High severity alerts go to the team-pager
  - match:
      severity: 'critical'
    receiver: 'critical-alerts'
    continue: true
    
  # All other alerts go to the default receiver
  - match:
      severity: 'warning'
    receiver: 'warning-alerts'

# Receivers
receivers:
- name: 'default-receiver'
  email_configs:
  - to: 'alerts@yourdomain.com'
    send_resolved: true
    headers: { Subject: "[ALERT] {{ .CommonLabels.alertname }}" }
    
- name: 'critical-alerts'
  email_configs:
  - to: 'oncall-team@yourdomain.com'
    send_resolved: true
    headers: { Subject: "[CRITICAL] {{ .CommonLabels.alertname }}" }
  
  # Slack configuration for critical alerts
  slack_configs:
  - api_url: '${ALERTMANAGER_SLACK_WEBHOOK_URL}'
    channel: '${ALERTMANAGER_SLACK_CHANNEL:-#alerts}'
    send_resolved: true
    title: '{{ template "slack.default.title" . }}'
    text: '{{ template "slack.default.text" . }}'
    title_link: '{{ template "slack.default.titlelink" . }}'
    
- name: 'warning-alerts'
  email_configs:
  - to: 'dev-team@yourdomain.com'
    send_resolved: true
    headers: { Subject: "[WARNING] {{ .CommonLabels.alertname }}" }

# Templates for Slack messages
templates:
- '/etc/alertmanager/template/*.tmpl'
